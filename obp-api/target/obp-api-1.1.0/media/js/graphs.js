var draw_bar_graph=function(z){sorted=z.stats.sort(function(w,h){return w.amount-h.amount});sorted=sorted.reverse();z=$(sorted).slice(0,100);var n=d3.select("#content"),b=d3.max(z).amount,t=10,i=330,r=330,o=30,u=0;n.insert("h2",".bar-chart").text("Bar Graph");n.insert("h3",".bar-chart").text("Top 20 API Request");var g=1050,s=2000,p=function(h){return"#00b3dc"};var f=d3.scale.linear().domain([0,b]).range([0,g-(i+r)]),d=d3.scale.ordinal().domain(d3.range(z.length)).rangeBands([u,s-o],0.5);var k=s-d.rangeBand()/2-o;var q=u+d.rangeBand()/2;var m=i+100;var c=g-100;var j=n.append("svg:svg").attr("width",g).attr("height",s).append("svg:g").attr("id","barchart").attr("class","barchart");var e=j.selectAll("g.rule").data(f.ticks(t)).enter().append("svg:g").attr("transform",function(h){return"translate("+(m+f(h))+")"});e.append("svg:line").attr("class","tick").attr("y1",k).attr("y2",k+4).attr("stroke","black");e.append("svg:text").attr("class","tick_label").attr("text-anchor","middle").attr("y",k).text(function(h){return h});var a=j.selectAll(".tick_label").node().getBBox();j.selectAll(".tick_label").attr("transform",function(h){return"translate(0,"+(a.height)+")"});var l=j.selectAll("g.bar").data(z).enter().append("svg:g").attr("class","bar").attr("transform",function(w,h){return"translate(0, "+d(h)+")"});l.append("svg:rect").attr("x",m).attr("width",function(h){return(f(h.amount))}).attr("height",d.rangeBand()).attr("fill",p(0)).attr("stroke",p(0));var v=j.selectAll("g.bar").append("svg:a").attr("width",200).append("svg:text").attr("class","label").attr("x",20).attr("text-anchor","right").text(function(h){return h.url});a=v.node().getBBox();j.selectAll(".label").attr("transform",function(h){return"translate(0, "+(d.rangeBand()/2+a.height/4)+")"});v=j.selectAll("g.bar").append("svg:text").attr("class","value").attr("x",function(h){return f(h.amount)+m+10}).attr("text-anchor","left").text(function(h){return""+h.amount});a=v.node().getBBox();j.selectAll(".value").attr("transform",function(h){return"translate(0, "+(d.rangeBand()/2+a.height/4)+")"});j.append("svg:line").attr("class","axes").attr("x1",m).attr("x2",m).attr("y1",q).attr("y2",k).attr("stroke","black");j.append("svg:line").attr("class","axes").attr("x1",m).attr("x2",c).attr("y1",k).attr("y2",k).attr("stroke","black")};d3.json("obp/metrics/demo-bar",function(a){draw_bar_graph(a)});d3.json("obp/metrics/demo-line",function(i){function d(h){return new Date(h.date)}var g=d(i.stats[0]),a=d(i.stats[i.stats.length-1]);var e=Math.max.apply(Math,i.stats.map(function(h){return h.amount}));var o=990,k=450,c=30,f=20,m=d3.scale.linear().domain([e,0]).range([0+f,k-f]),n=d3.time.scale().domain([g,a]).range([0+f,o-f]);var b=d3.select("#content").data([i.stats]).append("svg:svg").attr("width",o+c*2).attr("height",k+c*2).attr("class","line-chart").append("svg:g").attr("transform","translate("+c+","+c+")");var q=b.selectAll("g.rule").data(n.ticks(3)).enter().append("svg:g").attr("class","rule");q.append("svg:line").attr("x1",n).attr("x2",n).attr("y1",0).attr("y2",k-1);q.append("svg:line").attr("class",function(h){return h?null:"axis"}).attr("y1",m).attr("y2",m).attr("x1",0).attr("x2",o+1);q.append("svg:text").attr("x",n).attr("y",k+3).attr("dy",".71em").attr("text-anchor","middle").text(n.tickFormat(3));q.append("svg:text").attr("y",m).attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(m.tickFormat(3));b.append("svg:path").attr("class","line").attr("d",d3.svg.line().x(function(h){return n(d(h))}).y(function(h){return m(h.amount)}));b.selectAll("circle.line").data(i.stats).enter().append("svg:circle").attr("class","line").attr("cx",function(h){return n(d(h))}).attr("cy",function(h){return m(h.amount)}).attr("r",3.5);var j=d3.svg.axis().scale(m).ticks(5).orient("left");b.append("svg:g").attr("class","y axis").attr("transform","translate(10,0)").call(j);var l=d3.select("#content");l.insert("h2",".line-chart").text("Line Graph");l.insert("h3",".line-chart").text("Daily API Request");l.insert("p",".line-chart").attr("class","axis").text("Request")});